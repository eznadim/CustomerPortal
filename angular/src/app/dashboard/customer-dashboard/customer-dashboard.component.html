<abp-page [title]="'Customer Dashboard' | abpLocalization">
  <!-- Date Filter -->
  <div class="card">
    <div class="card-body">
      <form [formGroup]="formFilters" (ngSubmit)="refresh()"> 
        <div id="datepicker" class="input-daterange row align-items-center justify-content-center">
          <div class="col-12 col-lg-auto col-md-6 mb-3 mb-lg-0">
            <abp-date-range-picker
              formControlName="times"
              id="times"
              [labelText]="'::Date' | abpLocalization"
              startDateProp="fromDate"
              endDateProp="toDate"
            >
            </abp-date-range-picker>
          </div>
          <div class="col-12 col-lg-2 col-md-12">
            <button type="submit" class="btn btn-primary btn-block">
              <span>{{ 'Refresh' | abpLocalization }}</span>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center my-3">
    <div class="spinner-border" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <!-- Dashboard Content -->
  <div id="CustomerDashboardWidgetsArea" *ngIf="isAuthenticated && !loading">
    <div class="row">
      <!-- Customer Info -->
      <div class="col-12 mb-4">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">Customer Information</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <p><strong>Name:</strong> {{ currentCustomer.customerName }}</p>
                <p><strong>Email:</strong> {{ currentCustomer.email }}</p>
              </div>
              <div class="col-md-6">
                <p><strong>Address:</strong> {{ currentCustomer.address || 'Not provided' }}</p>
                <p><strong>Customer ID:</strong> {{ currentCustomer.id }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Order Statistics -->
      <div class="col-md-12 col-lg-6 mb-4">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">Order Statistics</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-4 text-center">
                <h6>Total Orders</h6>
                <h3>{{ totalOrders }}</h3>
              </div>
              <div class="col-4 text-center">
                <h6>Pending</h6>
                <h3>{{ pendingOrders }}</h3>
              </div>
              <div class="col-4 text-center">
                <h6>Completed</h6>
                <h3>{{ completedOrders }}</h3>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Orders -->
      <div class="col-md-12 col-lg-6 mb-4">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">Recent Orders</h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Order #</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Amount</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let order of customerOrders">
                    <td>{{ order.orderNumber }}</td>
                    <td>{{ order.orderDate | date }}</td>
                    <td>
                      <span [class]="'badge badge-' + order.status.toLowerCase()">
                        {{ order.status }}
                      </span>
                    </td>
                    <td>{{ order.totalAmount | currency }}</td>
                  </tr>
                  <tr *ngIf="customerOrders.length === 0">
                    <td colspan="4" class="text-center">No orders found</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Not Authenticated Message -->
  <div *ngIf="!isAuthenticated && !loading" class="alert alert-warning">
    <p>Please log in to view your dashboard.</p>
  </div>
</abp-page>
